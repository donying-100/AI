<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文本清理与替换工具</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f5f7;
      color: #1d1d1f;
      display: flex;
      height: 100vh;
    }
    .panel {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .left {
      border-right: 1px solid #e5e5ea;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .char-count {
      font-size: 14px;
      color: #888;
      background: #f0f0f0;
      padding: 4px 8px;
      border-radius: 12px;
    }
    textarea {
      flex: 1;
      width: 100%;
      border-radius: 12px;
      border: 1px solid #d2d2d7;
      padding: 12px;
      font-size: 15px;
      resize: none;
      outline: none;
    }
    .controls label {
      display: block;
      margin: 10px 0 4px;
      font-weight: 600;
      font-size: 14px;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #d2d2d7;
      outline: none;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      flex: 1;
      padding: 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #d2d2d7;
      cursor: pointer;
      background: #fff;
      min-width: 100px;
    }
    button.primary {
      background: #0071e3;
      color: #fff;
      border: none;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .output {
      margin-top: 20px;
      flex: 1;
      border: 1px solid #d2d2d7;
      border-radius: 12px;
      padding: 12px;
      white-space: pre-wrap;
      background: #fff;
      overflow: auto;
    }
  </style>
</head>
<body>
  <div class="panel left">
    <div class="header">
      <h2>原始文本</h2>
      <div class="char-count" id="charCount">汉字: 0</div>
    </div>
    <textarea id="inputText" placeholder="在这里输入或粘贴你的文本..."></textarea>
  </div>
  <div class="panel right">
    <h2>清理与替换</h2>
    <div class="controls">
      <label for="findText">要删除/替换的内容</label>
      <input type="text" id="findText" placeholder="输入要删除或替换的文字...">

      <label for="replaceText">替换为（留空则删除）</label>
      <input type="text" id="replaceText" placeholder="输入替换后的文字（可选）...">
    </div>
    <div class="buttons">
      <button id="execute" class="primary">执行替换</button>
      <button id="removeSpecialChars">删除特殊字符</button>
      <button id="undo">撤销</button>
      <button id="clear">清空输入</button>
      <button id="copy">复制结果</button>
      <button id="download">导出 TXT</button>
    </div>
    <div class="output" id="outputText"></div>
  </div>

  <script>
    const inputText = document.getElementById("inputText");
    const findText = document.getElementById("findText");
    const replaceText = document.getElementById("replaceText");
    const outputText = document.getElementById("outputText");
    const executeBtn = document.getElementById("execute");
    const removeSpecialCharsBtn = document.getElementById("removeSpecialChars");
    const undoBtn = document.getElementById("undo");
    const charCount = document.getElementById("charCount");
    
    // 操作历史栈，最多保存3次操作
    const historyStack = [];
    const maxHistory = 3;
    
    // 计算汉字数量的函数
    function countChineseCharacters(text) {
      // 使用正则表达式匹配汉字（Unicode范围：\u4e00-\u9fff）
      const chineseChars = text.match(/[\u4e00-\u9fff]/g);
      return chineseChars ? chineseChars.length : 0;
    }
    
    // 更新汉字计数显示
    function updateCharCount() {
      const count = countChineseCharacters(inputText.value);
      charCount.textContent = `汉字: ${count}`;
    }
    
    // 保存当前状态到历史栈
    function saveToHistory() {
      if (historyStack.length >= maxHistory) {
        historyStack.shift(); // 移除最旧的历史记录
      }
      historyStack.push(inputText.value);
      updateUndoButton();
    }
    
    // 更新撤销按钮状态
    function updateUndoButton() {
      undoBtn.disabled = historyStack.length === 0;
    }
    
    // 执行替换操作
    function executeReplace() {
      saveToHistory(); // 保存当前状态到历史
      const find = findText.value;
      const replace = replaceText.value;
      if (find) {
        const regex = new RegExp(find, "g");
        inputText.value = inputText.value.replace(regex, replace);
      }
      // 更新输出区域显示当前文本
      outputText.textContent = inputText.value;
      // 更新汉字计数
      updateCharCount();
    }
    
    // 删除特殊字符功能
    function removeSpecialCharacters() {
      saveToHistory(); // 保存当前状态到历史
      // 删除 -…"' ''''' 这几个字符，包括中英文单引号
      const specialCharsRegex = /'''|''|[-…"'\u0027\u2018\u2019]/g;
      inputText.value = inputText.value.replace(specialCharsRegex, '');
      // 更新输出区域显示当前文本
      outputText.textContent = inputText.value;
      // 更新汉字计数
      updateCharCount();
    }
    
    // 撤销操作
    function undoOperation() {
      if (historyStack.length > 0) {
        const previousState = historyStack.pop();
        inputText.value = previousState;
        outputText.textContent = inputText.value;
        // 更新汉字计数
        updateCharCount();
      }
      updateUndoButton();
    }
    
    // 初始化撤销按钮状态和汉字计数
    updateUndoButton();
    updateCharCount();
    
    // 事件监听器
    executeBtn.addEventListener("click", executeReplace);
    removeSpecialCharsBtn.addEventListener("click", removeSpecialCharacters);
    
    undoBtn.addEventListener("click", undoOperation);
    
    document.getElementById("clear").addEventListener("click", () => {
      saveToHistory(); // 保存当前状态到历史
      inputText.value = "";
      findText.value = "";
      replaceText.value = "";
      outputText.textContent = "";
      // 更新汉字计数
      updateCharCount();
    });
    
    document.getElementById("copy").addEventListener("click", () => {
      navigator.clipboard.writeText(inputText.value);
      alert("结果已复制到剪贴板！");
    });
    
    document.getElementById("download").addEventListener("click", () => {
      const blob = new Blob([inputText.value], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "result.txt";
      a.click();
      URL.revokeObjectURL(url);
    });
    
    // 实时更新输出区域和汉字计数
    inputText.addEventListener("input", () => {
      outputText.textContent = inputText.value;
      updateCharCount();
    });
  </script>
</body>
</html>
